# プロジェクト引継ぎ情報サマリー (2025-04-09終了時点)

## 1. プロジェクト概要

- **目標:** ユーザー定義キャラクターとロールプレイできるチャットアプリケーションを作成する。チャット内容に応じてキャラクターの様子を描写した画像を生成する機能も搭載する。
- **形式:** Webアプリケーション

## 2. 技術スタック (暫定決定含む)

- **フロントエンド:** React (TypeScript) - Vite でプロジェクト作成済み
- **バックエンド:** C# (ASP.NET Core Minimal API) - プロジェクト作成済み、基本エンドポイント実装済み
- **文章生成API:** Google Gemini API (APIキー取得済み、バックエンドからの呼び出し実装済み)
- **画像生成API:**
    - Google Cloud Vertex AI (Imagen) - (実装中、GCP無料クレジット利用)
    - (検討中/将来実装) Stable Diffusion on Azure Machine Learning - (Azure ML学習・コスト考慮)
- **データベース:** MySQL (利用予定、実装はこれから)
- **開発環境:** VSCode, Git, GitHub
- **クラウド:**
    - Azure (学習中, Azure ML 検討, デプロイ先として検討)
    - Google Cloud (Gemini API, Vertex AI Imagen 利用)

## 3. PCスペック (ユーザー提供情報)

- **CPU:** Intel Core i7-9700KF (8コア/8スレッド)
- **マザーボード:** MSI Z390-A PRO
- **GPU:** NVIDIA GeForce GT 730 (AIアクセラレーションには不向き)
- **メモリ:** Team Elite Plus 16GB (2x8GB) DDR4-2666
- **SSD 1:** Samsung 970 EVO Plus 250GB (NVMe M.2)
- **SSD 2:** SanDisk Ultra 3D 500GB (SATA)
- **電源ユニット:** 玄人志向 KRPW-AK650W/88+ (650W 80PLUS Silver)
- **OS:** Windows 10 Home

## 4. 主な決定事項・調査結果メモ

- **`curl`での日本語送信:** Git Bash on Windows では `-d '...'` で直接日本語を渡すと文字化けする可能性が高い。UTF-8で保存したファイルを `-d @filename` で指定するのが確実。
- **C# / .NET:** アクセス修飾子、プロパティ、コンストラクタ、DI、Implicit Usings、User Secrets 等の基本仕様を学習・適用中。
- **APIキー管理:** Gemini APIキー、GCPサービスアカウントキー等は User Secrets または環境変数で管理する。ソースコードへの直接記述は避ける。
- **クラウド無料枠:**
    - GCP: $300相当の無料クレジットを利用中 (Vertex AI Imagen等)。有効期限・予算アラートに注意。
    - Azure: 無料アカウントのクレジット/無料枠を活用予定。
- **デプロイ方針:** クラウド (Azure or GCP) を利用する。自宅PCでの公開は行わない。最終的にはAzureでの公開を目指す。
- **ローカルLLM:** 不採用 (Gemini APIで代替、PCスペック懸念のため)。
- **画像生成方針:**
    1. まず Vertex AI Imagen API で実装を進める。
    2. 開発に余裕が出れば、学習目的で Azure ML + Stable Diffusion (スポットVM利用検討) の実装に挑戦する。
    3. Azure OpenAI (DALL-E 3) は現時点では採用しない。
- **Azure ML利用時の注意:** コンピューティングリソース（特にエンドポイントのVM）は利用しない時は停止するなど、コスト管理を意識する。スポットVMは可用性リスクを理解の上で利用検討。

## 5. 現在の進捗 (ToDoリスト)

### I. 環境準備・調査 (クラウド - GCP Vertex AI) - **実施中**

- [x] GCPプロジェクト確認・選択 (無料クレジット適用)
- [x] Vertex AI API有効化
- [x] 認証情報準備 (サービスアカウントキー作成、環境変数設定完了)
- [ ] **Imagen APIドキュメント確認:**
    - [ ] レスポンス形式の詳細（画像データの形式: Base64等）を確認する。
    - [ ] 利用可能なパラメータ（画像サイズ、スタイル指定、ネガティブプロンプト等）を確認する。
    - [ ] 料金体系（クレジット消費量/画像生成あたり）を再確認する。
- [x] コスト管理設定: (予算アラート設定を推奨)

### II. 環境準備・調査 (クラウド - Azure ML + Stable Diffusion) - **(将来検討)**

- [ ] **Azure ML 基本概念学習:** ワークスペース、コンピューティング、モデル、エンドポイント、環境、推論スクリプト等の役割を理解する。
- [ ] **モデル選定:** Azure ML モデルカタログや Hugging Face で利用可能な Stable Diffusion モデル（バージョン、ライセンス）を調査する。
- [ ] **マネージドオンラインエンドポイント調査:**
    - [ ] デプロイ手順（コードベース or ノーコード/ローコード）を確認する。
    - [ ] 推論スクリプトの作成方法・サンプルを確認する (Python)。
    - [ ] 必要なコンピューティングリソース（GPUの種類、vCPU, メモリ）のスペックを見積もる。
- [ ] **スポットVM調査:**
    - [ ] マネージドオンラインエンドポイントでのスポットVM利用方法と制限を確認する。
    - [ ] 中断時の挙動とアプリケーションへの影響を理解する。
    - [ ] スポット価格の変動と予算への影響を考慮する。
- [ ] **コスト試算:** エンドポイントのVM稼働時間、ストレージ等を考慮したコストを見積もり、Imagen API（従量課金）と比較検討する。

### III. 設計・開発

- [x] **タスク①: 外部API(Gemini)疎通確認** (完了)
- [x] **タスク②: 基本的なWebアプリケーションフロー構築** (完了)
- [ ] **タスク③: 画像生成API連携 (Vertex AI Imagen)** ← **Next!**
    - [x] C# バックエンドから Imagen API を呼び出す処理の実装 (**疎通確認完了**)
    - [ ] **APIレスポンスから画像データを取得・処理する:** (例: Base64デコード)
    - [ ] **フロントエンドから画像生成をトリガーし、結果の画像を表示する機能の実装:** (ローディング表示なども考慮)
    - [ ] 利用可能なパラメータ（画像サイズ、ネガティブプロンプト等）をリクエストに追加する機能
    - [ ] エラーハンドリング改善 (APIエラー、画像取得失敗など)
- [ ] **タスク④: 要件・設計の再整理、追加機能実装**
    - [ ] キャラクター設定機能の詳細設計・実装（設定項目、保存方法など）
    - [ ] チャット履歴保存機能（DB: MySQL）の設計・実装 (テーブル設計、ORM/SQL、API)
    - [ ] UI/UXの改善（キャラクター選択、チャット表示、設定画面など）
    - [ ] セキュリティ考慮事項の洗い出し（APIキー保護、入力検証など）
- [ ] **タスク⑤ (将来検討): 画像生成API連携 (Azure ML Stable Diffusion)**
    - [ ] Azure ML 環境構築 (II. の調査に基づく)
    - [ ] Stable Diffusion モデルのデプロイ
    - [ ] C# バックエンドから Azure ML エンドポイントを呼び出す処理の実装
    - [ ] (オプション) Imagen と Stable Diffusion を切り替えられる仕組みを検討

### IV. デプロイ準備・検討 (開発と並行)

- [ ] **デプロイ先プラットフォーム選定 (Azure有力):**
    - [ ] Azure App Service, Azure Static Web Apps, Azure Container Apps 等の機能・料金比較
    - [ ] Azure Database for MySQL の調査
- [ ] **CI/CDパイプライン検討:** (GitHub Actions 等)
- [ ] **ドメイン取得・設定検討:**
- [ ] **コスト試算 (公開時):** 選択した構成での月額費用見積もり
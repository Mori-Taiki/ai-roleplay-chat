# プロジェクト引継ぎ情報サマリー (2025-04-08終了時点)

## 1. プロジェクト概要

- **目標:** ユーザー定義キャラクターとロールプレイできるチャットアプリケーションを作成する。チャット内容に応じてキャラクターの様子を描写した画像を生成する機能も搭載する。
- **形式:** Webアプリケーション

## 2. 技術スタック (暫定決定含む)

- **フロントエンド:** React (TypeScript) - Vite でプロジェクト作成済み
- **バックエンド:** C# (ASP.NET Core Minimal API) - プロジェクト作成済み、基本エンドポイント実装済み
- **文章生成API:**
    - Google Gemini API (APIキー取得済み、バックエンドからの呼び出し実装済み)
    - ローカルLLM (試用予定、優先度下げ) - バックエンドから切り替え可能にする方針
- **画像生成API:**
    - Google Cloud Vertex AI (Imagen) - (実装予定、GCP無料クレジット利用)
    - Azure OpenAI Service (DALL·E 3) - (調査・実装はImagenの後)
- **データベース:** MySQL (利用予定、実装はこれから)
- **開発環境:** VSCode, Git, GitHub
- **クラウド:**
    - Azure (学習中、Azure OpenAI Service 利用・デプロイ先として検討)
    - Google Cloud (Vertex AI Imagen 利用のため)

## 3. PCスペック (ユーザー提供情報)

- **CPU:** Intel Core i7-9700KF (8コア/8スレッド)
- **マザーボード:** MSI Z390-A PRO
- **GPU:** NVIDIA GeForce GT 730 (LLMアクセラレーションには不向き)
- **メモリ:** Team Elite Plus 16GB (2x8GB) DDR4-2666 (ローカルLLM試用には増設検討)
- **SSD 1:** Samsung 970 EVO Plus 250GB (NVMe M.2)
- **SSD 2:** SanDisk Ultra 3D 500GB (SATA)
- **電源ユニット:** 玄人志向 KRPW-AK650W/88+ (650W 80PLUS Silver)
- **OS:** Windows 10 Home

## 4. 主な決定事項・調査結果メモ

- **`curl`での日本語送信:** Git Bash on Windows では `-d '...'` で直接日本語を渡すと文字化けする可能性が高い。UTF-8で保存したファイルを `-d @filename` で指定するのが確実。
- **C# アクセス修飾子:** `public`/`private` はJavaとほぼ同じ。`protected` はJavaと異なる。`internal` はアセンブリ単位。デフォルトは `private`。
- **C# プロパティ:** `{ get; set; }` (自動実装プロパティ) が標準。フィールドとは区別される。JSONシリアライザはプロパティを対象とするため `public` でも `{ get; set; }` が必要。
- **C# コンストラクタ:** 明示的に定義しなければ、引数なしの `public` なデフォルトコンストラクタが自動生成される。JSONデシリアライズで利用される。
- **C# `required` 修飾子:** Null許容参照型警告の対策として、JSONデシリアライズで必須のプロパティに付与するのが有効な場合がある。
- **C# DIとImplicit Usings:** `IHttpClientFactory` 等が `using` なしで使えるのは、Implicit Usings と DI (依存性の注入) の仕組みによる。
- **RAM増設:** メーカー違いのメモリ混在は可能だが非推奨。スペック（容量、速度、タイミング）を合わせるのが重要。キット交換がベスト。
- **APIキー管理:** 各種APIキーは、ソースコードに直接埋め込まず、環境変数や設定ファイル (`appsettings.json`のUser Secrets等) で管理する。
- **クラウド無料枠:**
    - GCP: $300相当の無料クレジット取得済み。Vertex AI Imagen等に利用可能。有効期限注意。予算アラート設定推奨。
    - Azure: 無料アカウントには$200相当(30日間)のクレジットと12ヶ月無料枠が含まれる可能性。Azure OpenAI利用には申請・承認が必要な場合あり。
- **デプロイ方針:** クラウド (Azure or GCP) を利用する。自宅PCでの公開は行わない。最終的にはAzureでの公開を目指す。

## 5. 現在の進捗 (ToDoリスト)

(旧リストは下記の新リストに更新)

### I. 環境準備・調査 (ローカルLLM) - (優先度変更・保留)

- [ ] **ローカルLLMツール選定・導入:**
    - [ ] Ollama または LM Studio の情報を確認し、どちらか（または両方）をインストールする。
    - [ ] 簡単なコマンド/操作で動作確認する。
- [ ] **ローカルLLMモデル選定・テスト:**
    - [ ] Ollama/LM Studioで利用可能なモデル（Llama 3 8B Instruct, Mistral 7B Instruct等の量子化版）をいくつか試す。
    - [ ] 応答速度、日本語の自然さ、キャラクター応答のテストなど、簡単な評価を行う。
    - [ ] ローカルAPIサーバー機能を使って、簡単なプログラムからアクセスできるか試す。

### II. 環境準備・調査 (クラウド - GCP Vertex AI) - **進行中**

- [ ] **GCPプロジェクト確認:** 無料クレジットが適用されているプロジェクトを確認。
- [ ] **Vertex AI API有効化:** プロジェクトで Vertex AI API を有効にする。
- [ ] **認証情報準備:**
    - [ ] サービスアカウントを作成し、必要なロール (例: Vertex AI ユーザー) を付与する。
    - [ ] サービスアカウントキー (JSONファイル) をダウンロードし、安全な場所に保管する (例: User Secrets)。
- [ ] **Imagen APIドキュメント確認:**
    - [ ] C# 用のクライアントライブラリ (Google.Cloud.AIPlatform.V1) または REST API の使い方を確認する。
    - [ ] リクエスト/レスポンス形式、パラメータ（プロンプト、画像サイズ、生成枚数など）を確認する。
    - [ ] 料金体系（クレジット消費量）を再確認する。
- [ ] **コスト管理設定:**
    - [ ] GCPコンソールで予算アラートを設定し、クレジット消費を監視する。

### III. 環境準備・調査 (クラウド - Azure OpenAI) - (Imagen実装後に実施)

- [ ] **Azureアカウント/サブスクリプション確認:** 無料クレジット/無料枠の状況を確認。
- [ ] **Azure OpenAI Service 利用申請:**
    - [ ] 必要であれば利用申請を行う (DALL-E 3 利用目的等)。承認状況を確認する。
- [ ] **Azure OpenAI リソース作成:**
    - [ ] 利用可能なリージョンを選択し、Azure OpenAI リソースを作成する。
    - [ ] 作成したリソースのエンドポイントとAPIキーを控える。
- [ ] **DALL-E 3 APIドキュメント確認:**
    - [ ] C# 用の SDK (Azure.AI.OpenAI) または REST API の使い方を確認する。
    - [ ] リクエスト/レスポンス形式、パラメータを確認する。
    - [ ] 料金体系を再確認する。
- [ ] **コスト管理設定:**
    - [ ] Azureポータルで予算アラートを設定する。

### IV. 設計・開発

- [x] **タスク①: 外部API(Gemini)疎通確認**
    - [x] APIキー取得
    - [x] `curl`でのAPI呼び出し成功
- [x] **タスク②: 基本的なWebアプリケーションフロー構築**
    - [x] VSCode環境設定（日本語化、拡張機能インストール）
    - [x] C# Minimal API プロジェクト作成・起動確認
    - [x] 最小限のAPIエンドポイント実装 (例: `/api/chat`)
    - [x] バックエンドAPIの単体テスト成功 (`curl @file`でのテスト)
    - [x] React(TypeScript) プロジェクト作成・起動確認
    - [x] 最小限の画面作成（入力欄、送信ボタン、応答表示エリア）
    - [x] フロントエンドからバックエンドAPIへのリクエスト送信
    - [x] バックエンドからGemini API呼び出し (ファイル生成不要な方法で)
    - [x] Gemini APIからの応答をフロントエンドに表示 (エンドツーエンド確認済み)
- [ ] **タスク③: 画像生成API連携 (Vertex AI Imagen)** ← **Next!**
    - [ ] Google Cloud プロジェクト設定、Vertex AI API 有効化 (II.で実施)
    - [ ] 認証情報（サービスアカウントキー等）の設定・準備 (II.で実施)
    - [ ] C# バックエンドから Imagen API を呼び出す処理の実装 (SDK or REST API)
    - [ ] フロントエンドから画像生成をトリガーし、結果を表示する機能の実装
    - [ ] GCP無料クレジットの範囲内での動作確認、コスト監視設定検討 (II.で実施済を確認)
- [ ] **タスク④: 画像生成API連携 (Azure OpenAI DALL-E 3)**
    - [ ] Azure OpenAI Service の利用申請状況確認・承認待ち (III.で実施)
    - [ ] Azure OpenAI リソース作成、APIキー/エンドポイント取得 (III.で実施)
    - [ ] C# バックエンドから DALL-E 3 API を呼び出す処理の実装
    - [ ] (オプション) Imagen と DALL-E 3 のどちらを利用するか設定等で切り替えられる仕組みを検討
- [ ] **タスク⑤: ローカルLLM試用 (優先度変更)**
    - [ ] (必要なら)メモリ増設検討
    - [ ] ローカルLLMツール(Ollama/LM Studio)導入・モデル実行
    - [ ] ローカルAPIサーバー経由でのアクセス試行
    - [ ] バックエンドからローカルLLM APIへのアクセス実装
- [ ] **タスク⑥: 要件・設計の再整理、追加機能実装**
    - [ ] キャラクター設定機能の詳細設計・実装
    - [ ] チャット履歴保存機能（DB: MySQL）の設計・実装
    - [ ] UI/UXの改善（画像表示方法、ローディング表示など）
    - [ ] エラーハンドリング強化、セキュリティ考慮事項の洗い出し

### V. デプロイ準備・検討 (開発と並行)

- [ ] **デプロイ先プラットフォーム選定 (Azure有力):**
    - [ ] Azure App Service, Azure Static Web Apps, Azure Container Apps 等の機能・料金比較
    - [ ] Azure Database for MySQL の調査
- [ ] **CI/CDパイプライン検討:** (GitHub Actions 等)
- [ ] **ドメイン取得・設定検討:**
- [ ] **コスト試算 (公開時):** 選択した構成での月額費用見積もり